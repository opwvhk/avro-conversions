![Build Status](https://github.com/opwvhk/avro-conversions/workflows/Java%20CI%20with%20Maven/badge.svg)
[![License](https://img.shields.io/github/license/opwvhk/avro-conversions?color=brightgreen)](https://www.apache.org/licenses/LICENSE-2.0.html)
[![Maven Central Version](https://img.shields.io/maven-central/v/net.sf.opk/avro-conversions?color=brightgreen)](https://maven-badges.herokuapp.com/maven-central/net.sf.opk/avro-conversions)

Avro Conversions
================

These Avro tools provide means to manipulate and/or describe schemas, including converting JSON and
XML Schema definitions (XSD) into Avro schemas. Additionally, it provides a way to parse non-Avro
data into Avro data structures.

Usage
-----

The class below describes how to use all functionality. It is a contrived example, as (for example)
describing a schema in Markdown format and parsing data are not usually combined…

```java
import opwvhk.avro.SchemaManipulator;
import opwvhk.avro.json.JsonAsAvroParser;
import opwvhk.avro.xml.XmlAsAvroParser;
import org.apache.avro.Schema;
import org.apache.avro.generic.GenericRecord;

class Example {
	public static void main(String[] args) throws Exception {
		Schema fromAvsc = SchemaManipulator.fromAvro(new URL(args[0]))
				// By default, renaming fields/schemata will also add the old name as an alias.
				.renameWithoutAliases()
				.renameField("newName", "path", "to", "field")
				.renameSchema("NewName", "OldName")
				.finish();

		GenericData model = GenericData.get();

		if (!args[1].endsWith(".xsd")) {
			Schema fromJson = SchemaManipulator.startFromJsonSchema(new URL(args[1])).finish();
            // Note: JsonAsAvroParser can also handle JSON without a JSON schema,
			// but in that case it cannot fail early if the data is invalid
			JsonAsAvroParser parser = new JsonAsAvroParser(new URL(args[1]), fromJson, model);
			// The record type depends on the class generated by GenericData.get() (you can also use SpecificData or ReflectiveData).
			GenericRecord record = parser.parse(new URL(args[2]));
			System.out.println(record);
			return;
		}

		StringBuilder buffer = new StringBuilder();
		Schema fromXsd = SchemaManipulator.fromXsd(new URL(args[1]))
				// Unwrapping drops the single-field schema and makes the schema of its field the schema of the wrapping field.
				.unwrapArray("path", "to", "non-array", "field", "with", "single-element", "schema")
				// Unwraps all non-array fields with single-array-field schemata,
				// provided the field names (except up to the last 3 characters) are the same.
				// Note: 3 is a good number for English names
				.unwrapArrays(3)
				.renameField("newName", "path", "to", "field")
				.renameSchema("NewName", "OldName")
				.alsoDocumentAsMarkdownTable(buffer)
				.finish();

		// Print the schema as a Markdown table
		System.out.println(buffer);

		XmlAsAvroParser parser = new XmlAsAvroParser(new URL(args[1]), args[2], fromXsd, model);
		// The record type depends on the class generated by the model, set to GenericData.get() above.
		// You can also use SpecificData or ReflectiveData to create different record types.
		GenericRecord record = parser.parse(new URL(args[3]));
		System.out.println(record);
	}
}
```

Contributing ✨
---------------

<!--
TODO: uncomment when there are multiple committers
A special thank you to all who contributed! All contributions are sincerely appreciated.

[![Contributors](https://contrib.rocks/image?repo=opwvhk/avro-conversions)](https://github.com/opwvhk/avro-conversions/graphs/contributors)
-->

Are you interested in contributing? These links may be of interest:

* [Contributing Guidelines](CONTRIBUTING.md)
* [Good First Issues](https://github.com/opwvhk/avro-conversions/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22)
